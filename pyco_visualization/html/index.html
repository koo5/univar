<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<script type="text/javascript" src="vue.js"></script>
	<script type="text/javascript" src="jquery-3.3.1.js"></script>
	<link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="top">
	<div id="step_id">
		step: <span v-html="step_id"></span>
	</div>
	<div id="trace">
		<span> {{ root.trace }} </span>
	</div>
</div>
<script type="text/javascript">
	
	$( document ).ready(function() {
		console.log( "ready!" );
$.getScript( "../trace0.js", function( data, textStatus, jqxhr ) {
  console.log( data ); // Data returned
  console.log( textStatus ); // Success
  console.log( jqxhr.status ); // 200
  console.log( "Load was performed." );
  next_step();
});    
});

	function S(x)
	{
		vm.steps.push(x);
	}

	var vm = new Vue({
		el: '#top',
		data: {
			root : {"trace": {"banana":"pie"}},
			step_id: -1,
			file_offset: 0,
			steps: [],
			states: [],
		},
		mounted: function ()
		{
			this.$nextTick(function () {
			window.addEventListener('keydown', function (event) {
				c = event.keyCode;
				if (c==188 && vm.step_id > 0)
				{
					vm.step_id--;
				}
				if (c==190 && vm.steps.length > 0)
					next_step();
			});
			});
		}
	});

	function next_step()
	{
		console.log("next_step");

		vm.step_id++;
		let step_idx = vm.step_id - vm.file_offset;
		let step = vm.steps[vm.step_id - vm.file_offset];
		//console.log(vm.steps);
		step.forEach(op => {do_op(op);});
	}

	function do_op(op)
	{
		let action = op.a;
		console.log(op);

		if (action == "add")
		{
			state = {"children":[]};
			state.id = op["id"];
			state.parent_id = op["parent_id"];
			let parent = state.parent_id.toString();
			let adding = state.id.toString();
			vm.states[adding] = state;
			if (vm.states.hasOwnProperty(parent))
				vm.states[parent].children.push(state)
			else
				vm.root.trace = state;
		}
	}

</script>
<!-- <script type="text/javascript" src="../trace0.js"></script> -->
</body>
</html>
